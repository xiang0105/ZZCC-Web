<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èª²ç¨‹æŸ¥è©¢</title>
    <link rel="icon" type="image/x-icon" href="./images/logo.ico">
    <style>
        /* --- åŸºç¤è¨­å®šèˆ‡é…è‰² --- */
        :root {
            --primary-blue: #003366;    /* ä¸»è‰²ï¼šæ·±è— */
            --secondary-blue: #00509e;  /* æ¬¡è‰²ï¼šäº®è— */
            --accent-bg: #e6f0fa;       /* è£é£¾èƒŒæ™¯ï¼šæ¥µæ·ºè— */
            --white: #ffffff;
            --text-dark: #333333;
            --text-gray: #666666;
            --border-radius: 8px;
            --heart-color: #e83e8c;     /* æ„›å¿ƒé¡è‰² */
            --btn-green: #28a745;       /* ä¸‹è¼‰æŒ‰éˆ•ç¶ è‰² */
            --btn-green-hover: #218838;
            --btn-orange: #fd7e14;      /* æ–°ç”ŸæŒ‰éˆ•æ©˜è‰² */
            --btn-orange-hover: #e36d0d;
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: #f4f7fa;
            margin: 0;
            padding: 0;
            color: var(--text-dark);
        }

        /* --- é ‚éƒ¨ç¯©é¸å€ (Header) --- */
        header {
            background-color: var(--primary-blue);
            padding: 1.2rem 2rem;
            color: var(--white);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .filter-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            gap: 10px; 
            align-items: center;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        h1 {
            margin: 0;
            font-size: 1.5rem;
            margin-right: auto; 
            font-weight: 700;
            letter-spacing: 1px;
        }

        input#searchInput {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 0.95rem;
            outline: none;
            width: 180px;
        }

        select {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 0.95rem;
            outline: none;
            background-color: #fff;
            cursor: pointer;
        }

        button {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid rgba(255,255,255,0.2);
        }

        /* ç¯©é¸æŒ‰éˆ• */
        button#confirmBtn {
            background-color: var(--secondary-blue);
            color: var(--white);
        }
        button#confirmBtn:hover {
            background-color: #0066cc;
            transform: translateY(-1px);
        }

        /* æ”¶è—ç¯©é¸æŒ‰éˆ• */
        button#favFilterBtn {
            background-color: transparent;
            color: var(--white);
            border: 1px solid var(--white);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        button#favFilterBtn.active {
            background-color: var(--heart-color);
            border-color: var(--heart-color);
            color: white;
        }
        button#favFilterBtn:hover {
            background-color: rgba(255,255,255,0.1);
        }

        /* --- ä¸‹è¼‰æŒ‰éˆ•æ¨£å¼ --- */
        .btn-download {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none; /* å»é™¤è¶…é€£çµåº•ç·š */
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
            border: 1px solid rgba(255,255,255,0.2);
            background-color: var(--btn-green); 
            color: var(--white);
            font-size: 0.9rem;
            line-height: normal;
        }

        .btn-download:hover {
            background-color: var(--btn-green-hover);
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* æ–°ç”ŸæŒ‰éˆ•ç‰¹åˆ¥æ¨£å¼ (æ©˜è‰²) */
        .btn-download.new {
            background-color: var(--btn-orange);
        }
        .btn-download.new:hover {
            background-color: var(--btn-orange-hover);
        }

        /* --- èª²ç¨‹å¡ç‰‡å€ (Grid) --- */
        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .course-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .card {
            background-color: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-top: 5px solid var(--primary-blue);
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .card h3 {
            margin: 0 0 12px 0;
            color: var(--primary-blue);
            font-size: 1.25rem;
            line-height: 1.4;
            padding-right: 20px;
        }

        .card .info {
            font-size: 0.95rem;
            color: var(--text-gray);
            margin-bottom: 6px;
        }

        .card .status {
            margin-top: auto;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            width: fit-content;
            margin-top: 15px;
        }

        .status.full { background-color: #ffebee; color: #d32f2f; }
        .status.open { background-color: #e8f5e9; color: #2e7d32; }
        .status.limited { background-color: #fff3e0; color: #ef6c00; }

        /* æ„›å¿ƒæŒ‰éˆ•æ¨£å¼ */
        .heart-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s, transform 0.2s;
            z-index: 10;
        }
        .heart-btn:hover {
            transform: scale(1.2);
        }
        .heart-btn.active {
            color: var(--heart-color);
        }

        /* Modal æ¨£å¼ */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(3px); z-index: 1000; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.3s ease; }
        .modal-overlay.active { display: flex; opacity: 1; }
        .modal-content { background-color: var(--white); width: 90%; max-width: 600px; max-height: 90vh; border-radius: 12px; display: flex; flex-direction: column; position: relative; transform: translateY(20px); transition: transform 0.3s ease; box-shadow: 0 15px 40px rgba(0,0,0,0.25); }
        .modal-overlay.active .modal-content { transform: translateY(0); }
        .modal-header { background-color: var(--primary-blue); color: white; padding: 20px 30px; border-top-left-radius: 12px; border-top-right-radius: 12px; position: relative; flex-shrink: 0; }
        .modal-title { margin: 0; font-size: 1.5rem; font-weight: bold; padding-right: 30px; }
        .close-btn { position: absolute; top: 20px; right: 20px; font-size: 1.8rem; line-height: 1; cursor: pointer; color: rgba(255,255,255,0.7); transition: color 0.2s; }
        .close-btn:hover { color: white; }
        .modal-body { padding: 30px; overflow-y: auto; flex-grow: 1; }
        .modal-info-grid { display: grid; grid-template-columns: 1fr; gap: 15px; background-color: #f8f9fa; padding: 20px; border-radius: 8px; }
        .modal-info-item { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        .modal-info-item:last-child { border-bottom: none; padding-bottom: 0; }
        .modal-info-item span.label { font-size: 0.95rem; color: #666; font-weight: bold; }
        .modal-info-item span.value { font-weight: 500; font-size: 1.05rem; color: var(--text-dark); text-align: right; }
        .modal-footer { padding: 20px 30px; border-top: 1px solid #eee; background-color: #fff; border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; text-align: center; flex-shrink: 0; }
        .btn-external { display: inline-flex; align-items: center; justify-content: center; padding: 12px 30px; background-color: var(--primary-blue); color: white; text-decoration: none; border-radius: 6px; font-weight: bold; font-size: 1rem; transition: background 0.2s, transform 0.1s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 100%; box-sizing: border-box; }
        .btn-external:hover { background-color: var(--secondary-blue); transform: translateY(-2px); }
        
        /* å³ä¸‹è§’æ‡¸æµ®æŒ‰éˆ• (å›ä¸»é ) */
        .fab-home { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background-color: var(--primary-blue); color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; text-decoration: none; box-shadow: 0 4px 12px rgba(0,0,0,0.3); font-size: 30px; transition: all 0.3s ease; z-index: 2000; border: 2px solid white; }
        .fab-home:hover { background-color: var(--secondary-blue); transform: translateY(-5px) scale(1.05); box-shadow: 0 8px 20px rgba(0,0,0,0.4); }
        .fab-home::after { content: "å›ä¸»é "; position: absolute; bottom: 70px; right: 50%; transform: translateX(50%); background-color: #333; color: white; padding: 5px 10px; border-radius: 5px; font-size: 12px; white-space: nowrap; opacity: 0; transition: opacity 0.3s; pointer-events: none; }
        .fab-home:hover::after { opacity: 1; }

        /* --- æ–°å¢ï¼šå…¶ä»–åŠŸèƒ½æŒ‰éˆ• (ä½æ–¼å›ä¸»é ä¸Šæ–¹) --- */
        .fab-other { 
            position: fixed; 
            bottom: 120px; /* 30px(base) + 60px(home) + 30px(gap) = 120px */
            right: 30px; 
            width: 60px; 
            height: 60px; 
            background-color: var(--primary-blue); 
            color: white; 
            border-radius: 50%; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            text-decoration: none; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.3); 
            font-size: 18px; /* å­—é«”ç¨å¾®èª¿å°ä¸€é»é»ï¼Œå› ç‚ºæ˜¯ä¸­æ–‡å…©å€‹å­— */
            font-weight: bold;
            transition: all 0.3s ease; 
            z-index: 2000; 
            border: 2px solid white; 
        }
        
        .fab-other:hover { 
            background-color: var(--secondary-blue); 
            transform: translateY(-5px) scale(1.05); 
            box-shadow: 0 8px 20px rgba(0,0,0,0.4); 
        }
        
        /* æç¤ºæ–‡å­— */
        .fab-other::after { 
            content: "å…¶ä»–é€£çµ"; 
            position: absolute; 
            right: 70px; 
            top: 50%; 
            transform: translateY(-50%); 
            background-color: #333; 
            color: white; 
            padding: 5px 10px; 
            border-radius: 5px; 
            font-size: 12px; 
            white-space: nowrap; 
            opacity: 0; 
            transition: opacity 0.3s; 
            pointer-events: none; 
        }
        .fab-other:hover::after { opacity: 1; }

    </style>
</head>
<body>

<header>
    <div class="filter-container">
        <h1>ä¸­æ­£ç¤¾å¤§èª²ç¨‹</h1>
        
        <input type="text" id="searchInput" placeholder="æœå°‹èª²ç¨‹æˆ–è¬›å¸«...">

        <select id="daySelect">
            <option value="all">æ‰€æœ‰æ˜ŸæœŸ</option>
            <option value="é€±ä¸€">é€±ä¸€</option>
            <option value="é€±äºŒ">é€±äºŒ</option>
            <option value="é€±ä¸‰">é€±ä¸‰</option>
            <option value="é€±å››">é€±å››</option>
            <option value="é€±äº”">é€±äº”</option>
            <option value="é€±å…­">é€±å…­</option>
        </select>

        <select id="statusSelect">
            <option value="all">æ‰€æœ‰ç‹€æ…‹</option>
            <option value="æ‹›ç”Ÿä¸­">æ‹›ç”Ÿä¸­</option>
            <option value="é¡æ»¿">é¡æ»¿</option>
            <option value="å°šé¤˜åé¡">å°šé¤˜åé¡</option>
        </select>

        <button id="favFilterBtn">â¤ï¸ åªçœ‹æ”¶è—</button>

        <button id="confirmBtn">ç¯©é¸</button>

        <a href="https://www.zzcc.tp.edu.tw/download/%E5%A0%B1%E5%90%8D%E8%A1%A8/114-2%E8%88%8A%E7%94%9F%E5%A0%B1%E5%90%8D%E8%A1%A8.pdf" target="_blank" class="btn-download" title="ä¸‹è¼‰èˆŠç”Ÿå ±åè¡¨">
            ğŸ“¥ èˆŠç”Ÿå ±å
        </a>

        <a href="https://www.zzcc.tp.edu.tw/download/%E5%A0%B1%E5%90%8D%E8%A1%A8/114-2%E6%96%B0%E7%94%9F%E5%A0%B1%E5%90%8D%E8%A1%A8.pdf" target="_blank" class="btn-download new" title="ä¸‹è¼‰æ–°ç”Ÿå ±åè¡¨">
            ğŸ“¥ æ–°ç”Ÿå ±å
        </a>
    </div>
</header>

<div class="container">
    <div class="course-grid" id="courseContainer">
        </div>
</div>

<a href="../../index.html" class="fab-home" title="å›ä¸»é ">ğŸ </a>

<a href="./other.html" target="_blank" class="fab-other" title="å…¶ä»–åŠŸèƒ½">å…¶ä»–</a>

<div id="courseModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title" id="modalTitle">èª²ç¨‹æ¨™é¡Œ</div>
            <span class="close-btn" onclick="closeModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div class="modal-info-grid">
                <div class="modal-info-item"><span class="label">è¬›å¸«</span><span class="value" id="modalTeacher"></span></div>
                <div class="modal-info-item"><span class="label">æ™‚é–“</span><span class="value" id="modalTime"></span></div>
                <div class="modal-info-item"><span class="label">ç·¨è™Ÿ</span><span class="value" id="modalId"></span></div>
                <div class="modal-info-item"><span class="label">è²»ç”¨</span><span class="value" id="modalFee"></span></div>
                <div class="modal-info-item"><span class="label">ç‹€æ…‹</span><span class="value" id="modalStatus"></span></div>
            </div>
        </div>
        <div class="modal-footer">
            <a href="#" id="modalLink" target="_blank" class="btn-external">æŸ¥çœ‹å®Œæ•´èª²ç¨‹å¤§ç¶± (å¦é–‹è¦–çª—) â†—</a>
        </div>
    </div>
</div>

<script>
    const container = document.getElementById('courseContainer');
    const daySelect = document.getElementById('daySelect');
    const statusSelect = document.getElementById('statusSelect');
    const searchInput = document.getElementById('searchInput');
    const confirmBtn = document.getElementById('confirmBtn');
    const favFilterBtn = document.getElementById('favFilterBtn');
    
    // Modal Elements
    const modal = document.getElementById('courseModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalTeacher = document.getElementById('modalTeacher');
    const modalTime = document.getElementById('modalTime');
    const modalId = document.getElementById('modalId');
    const modalFee = document.getElementById('modalFee');
    const modalStatus = document.getElementById('modalStatus');
    const modalLink = document.getElementById('modalLink');

    let globalCoursesData = [];
    let showFavoritesOnly = false; // æ”¶è—éæ¿¾æ¨¡å¼é–‹é—œ

    // --- 1. æ”¶è—åŠŸèƒ½ ---
    function getFavorites() {
        const stored = localStorage.getItem('myCourseFavorites');
        return stored ? JSON.parse(stored) : [];
    }

    function toggleFavorite(event, courseId) {
        event.stopPropagation(); // é˜»æ­¢å¡ç‰‡é»æ“Š
        
        let favorites = getFavorites();
        if (favorites.includes(courseId)) {
            favorites = favorites.filter(id => id !== courseId); // ç§»é™¤
        } else {
            favorites.push(courseId); // åŠ å…¥
        }
        
        localStorage.setItem('myCourseFavorites', JSON.stringify(favorites));
        filterCourses(); // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°åœ–ç¤º
    }

    // --- 2. è®€å–è³‡æ–™ ---
    async function fetchCourses() {
        container.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 20px;">æ­£åœ¨è®€å–èª²ç¨‹è³‡æ–™...</p>';
        try {
            // è«‹ç¢ºèªé€™æ˜¯ä½ çš„å¾Œç«¯ API ç¶²å€
            const response = await fetch('http://127.0.0.1:5000/api/courses');
            const data = await response.json();
            
            if (data.error) {
                container.innerHTML = '<p style="text-align:center; color:red">å¾Œç«¯éŒ¯èª¤ï¼š' + data.error + '</p>';
                return;
            }

            globalCoursesData = data;
            renderCourses(globalCoursesData);

        } catch (error) {
            container.innerHTML = '<p style="text-align:center; color:red">ç„¡æ³•é€£ç·šä¼ºæœå™¨ï¼Œè«‹ç¢ºèª Python app.py æ˜¯å¦å·²å•Ÿå‹•ã€‚</p>';
            console.error(error);
        }
    }

    // --- 3. æ¸²æŸ“èª²ç¨‹å¡ç‰‡ ---
    function renderCourses(data) {
        container.innerHTML = '';
        const favorites = getFavorites();

        if (data.length === 0) {
            container.innerHTML = '<p style="grid-column:1/-1; text-align:center; color:#666;">ç„¡ç¬¦åˆæ¢ä»¶çš„èª²ç¨‹</p>';
            return;
        }

        data.forEach(course => {
            let statusClass = 'open';
            if (course.status.includes('é¡æ»¿')) statusClass = 'full';
            else if (course.status.includes('å°šé¤˜') || course.status.includes('å')) statusClass = 'limited';
            
            const displayTime = course.time.replace('èµ·', '');

            // åˆ¤æ–·æ”¶è—ç‹€æ…‹
            const isFav = favorites.includes(course.id);
            const heartClass = isFav ? 'active' : '';
            const heartIcon = isFav ? 'â¤ï¸' : 'ğŸ¤';

            const card = document.createElement('div');
            card.className = 'card';
            card.onclick = () => openModal(course.id);

            card.innerHTML = `
                <div class="heart-btn ${heartClass}" onclick="toggleFavorite(event, '${course.id}')">
                    ${heartIcon}
                </div>
                <h3>${course.name}</h3>
                <div class="info">è¬›å¸«ï¼š${course.teacher}</div>
                <div class="info">æ™‚é–“ï¼š${course.day} ${displayTime}</div>
                <div class="info">ç·¨è™Ÿï¼š${course.id}</div>
                <div class="status ${statusClass}">${course.status}</div>
            `;
            container.appendChild(card);
        });
    }

    // --- 4. ç¯©é¸é‚è¼¯ ---
    function filterCourses() {
        const selectedDay = daySelect.value;
        const selectedStatus = statusSelect.value;
        const keyword = searchInput.value.trim().toLowerCase();
        const favorites = getFavorites();

        const filtered = globalCoursesData.filter(course => {
            // æ˜ŸæœŸ
            const matchDay = selectedDay === 'all' || course.day === selectedDay;
            
            // ç‹€æ…‹
            let matchStatus = false;
            if (selectedStatus === 'all') matchStatus = true;
            else if (selectedStatus === 'å°šé¤˜åé¡') matchStatus = course.status.includes('å°šé¤˜');
            else if (selectedStatus === 'é¡æ»¿') matchStatus = course.status.includes('é¡æ»¿');
            else matchStatus = course.status.includes('æ‹›ç”Ÿä¸­');

            // é—œéµå­—
            const matchKeyword = course.name.toLowerCase().includes(keyword) || 
                                 course.teacher.toLowerCase().includes(keyword);

            // æ”¶è—
            const matchFav = showFavoritesOnly ? favorites.includes(course.id) : true;

            return matchDay && matchStatus && matchKeyword && matchFav;
        });
        renderCourses(filtered);
    }

    // æ”¶è—éæ¿¾æŒ‰éˆ•äº‹ä»¶
    favFilterBtn.addEventListener('click', () => {
        showFavoritesOnly = !showFavoritesOnly;
        if (showFavoritesOnly) {
            favFilterBtn.classList.add('active');
            favFilterBtn.textContent = 'â¤ï¸ é¡¯ç¤ºå…¨éƒ¨';
        } else {
            favFilterBtn.classList.remove('active');
            favFilterBtn.textContent = 'â¤ï¸ åªçœ‹æ”¶è—';
        }
        filterCourses();
    });

    // --- 5. Modal æ§åˆ¶ ---
    function openModal(courseId) {
        const course = globalCoursesData.find(c => c.id === courseId);
        if (!course) return;

        modalTitle.textContent = course.name;
        modalTeacher.textContent = course.teacher;
        modalTime.textContent = `${course.day} ${course.time.replace('èµ·', '')}`;
        modalId.textContent = course.id;
        modalFee.textContent = course.fee;
        modalStatus.textContent = course.status;

        // é€£åˆ°è©³ç´°å¤§ç¶±é é¢
        modalLink.href = `course_detail.html?id=${course.id}&title=${encodeURIComponent(course.name)}`;

        modal.classList.add('active');
    }

    function closeModal() {
        modal.classList.remove('active');
    }

    // ç›£è½äº‹ä»¶
    confirmBtn.addEventListener('click', filterCourses);
    searchInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') filterCourses(); });
    modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

    // åˆå§‹åŒ–
    fetchCourses();

</script>

</body>
</html>